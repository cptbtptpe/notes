## 三步握手和四次挥手  
  
### 三步握手 - 描述一  
  
> 第一次握手：建立连接时，客户端发送 syn 包（syn=j）到服务器，并进入 SYN_SEND 状态，等待服务器确认；SYN：同步序列编号（Synchronize Sequence Numbers）。  
  
> 第二次握手：服务器收到 syn 包，必须确认客户的 SYN（ack=j+1），同时自己也发送一个 SYN 包（syn=k），即 SYN+ACK 包，此时服务器进入 SYN_RECV 状态；  
  
> 第三次握手：客户端收到服务器的 SYN+ACK 包，向服务器发送确认包 ACK(ack=k+1），此包发送完毕，客户端和服务器进入 ESTABLISHED（TCP 连接成功）状态，完成三次握手。  
  
### 三次握手 - 描述二  
  
> 第一次握手：host1 发送一个 TCP 标志位 SYN=1、ACK=0 的数据包给 host2，并随机会产生一个 Sequence number=3233.当 host2 接收到这个数据后，host2 由 SYN=1 可知客户端是想要建立连接；  
  
> 第二次握手：host2 要对客户端的联机请求进行确认，向 host1 发送应答号 ACK=1、SYN=1，确认号 Acknowledge number=3234，此值是 host1 的序列号加1，还会产生一个随机的序列号 Sequence number=36457，这样就告诉 host1 可以进行连接；  
  
> 第三次握手：host1 收到数据后检查 Acknowledge number 是否是3233+1的值，以及 ACK 的值是否为1，若为1，host1 会发送 ACK=1，确认号码 Acknowledge number=36457，告诉 host2,你的请求连接被确认，连接可以建立。 
  
### 四次挥手 - 描述一  
  
> 对于一个已经建立的连接，TCP 使用改进的三次握手来释放连接（使用一个带有 FIN 附加标记的报文段）。

> TCP关闭连接的步骤如下：  
  
> 第一步，当主机 A 的应用程序通知 TCP 数据已经发送完毕时，TCP 向主机 B 发送一个带有 FIN 附加标记的报文段（FIN 表示英文 finish）。  
  
> 第二步，主机 B 收到这个 FIN 报文段之后，并不立即用 FIN 报文段回复主机 A，而是先向主机 A 发送一个确认序号 ACK，同时通知自己相应的应用程序：对方要求关闭连接（先发送 ACK 的目的是为了防止在这段时间内，对方重传 FIN 报文段）。  
  
> 第三步，主机 B 的应用程序告诉 TCP：我要彻底的关闭连接，TCP 向主机 A 送一个FIN 报文段。  
  
> 第四步，主机 A 收到这个 FIN 报文段后，向主机 B 发送一个 ACK 表示连接彻底释放。  

### 四次挥手  - 描述二  
  
> 第一次挥手：当传输的数据到达尾部时，host1 向 host2 发送 FIN=1 标志位；可理解成，host1 向 host2 说，我这边的数据传送完成了，我准备断开了连接；  
  
> 第二次挥手：因 TCP 的连接是全双工的双向连接，关闭也是要从两边关闭；当 host2 收到 host1 发来的 FIN=1 的标志位后，host2 不会立刻向 host1 发送 FIND=1 的请求关闭信息，而是先向 host1 发送一个 ACK=1 的应答信息，表示：你请求关闭的请求我已经收到，但我可能还有数据没有完成传送，你再等下，等我数据传输完成了我就告诉你；  
  
> 第三次挥手：host2 数据传输完成，向 host1 发送 FIN=1，host1 收到请求关闭连接的请求后，host1 就明白 host2 的数据已传输完成，现在可以断开连接了，  
  
> 第四次挥手：host1 收到 FIND=1 后，host1 还是怕由于网络不稳定的原因，怕 host2 不知道他要断开连接，于是向 host2 发送 ACK=1 确认信息进行确认，把自己设置成 TIME_WAIT 状态并启动定时器，如果 host2 没有收到 ACK，host2 端 TCP 的定时器到达后，会要求 host1 重新发送 ACK，当 host2 收到 ACK 后，host2 就断开连接；当 host1 等待 2MLS（2倍报文最大生存时间）后，没有收到 host2 的重传请求后，他就知道 host2 已收到了 ACK，所以 host1 此时才关闭自己的连接。这一点我觉得设计得非常巧妙！

- [x] 认识 TCP 标志位 - 6种  
  
    `SYN(synchronous建立联机)`  
    `ACK(acknowledgement 确认)`  
    `PSH(push传送)`  
    `FIN(finish结束)`  
    `RST(reset重置)`  
    `URG(urgent紧急)`  
  
### 图解 TCP 与 UDP 的三次握手与四次挥手过程  
![图解TCP与UDP的三次握手与四次挥手过程][1]  
  
  [1]: https://github.com/jtleon/notes/blob/master/source/tcp.png  
